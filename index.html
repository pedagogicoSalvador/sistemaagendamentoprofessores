<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agendamento Professores</title>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState } = React;

const subjects = {
  "Língua Portuguesa e Redação": [
    { id: 1, name: "Profª. Juliana Tricot" },
    { id: 2, name: "Profª. Juliana Velho" }
  ],
  "Matemática": [
    { id: 3, name: "Profª. Aline" },
    { id: 4, name: "Profª Eliana" }
  ]
  // Adicione os demais professores e matérias...
};

const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSf4jLyx90AMqnKHQgx8guOJ6hiwBmLjjQBGbgJ_A0Zv51is7A/formResponse";

const fieldIds = {
  parentName: "Nome do responsável",
  studentName: "Nome do estudante",
  email: "E-mail",
  teacher: "Professor",
  subject: "Matéria",
  time: "Horário"
};

function generateTimeSlots() {
  const slots = [];
  let start = new Date();
  start.setHours(18, 30, 0, 0);
  const end = new Date();
  end.setHours(19, 50, 0, 0);
  while (start <= end) {
    slots.push(start.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', hour12: false }));
    start.setMinutes(start.getMinutes() + 10);
  }
  return slots;
}

function App() {
  const [step, setStep] = useState(1);
  const [selectedSubject, setSelectedSubject] = useState("");
  const [selectedTeacher, setSelectedTeacher] = useState(null);
  const [selectedSlot, setSelectedSlot] = useState("");
  const [parentName, setParentName] = useState("");
  const [studentName, setStudentName] = useState("");
  const [email, setEmail] = useState("");
  const timeSlots = generateTimeSlots();

  const handleBooking = async () => {
    if (!parentName || !studentName || !email || !selectedSlot || !selectedTeacher || !selectedSubject) {
      alert("Preencha todos os campos!");
      return;
    }

    const formData = new FormData();
    formData.append(fieldIds.parentName, parentName);
    formData.append(fieldIds.studentName, studentName);
    formData.append(fieldIds.email, email);
    formData.append(fieldIds.teacher, selectedTeacher.name);
    formData.append(fieldIds.subject, selectedSubject);
    formData.append(fieldIds.time, selectedSlot);

    try {
      await fetch(FORM_URL, { method: "POST", mode: "no-cors", body: formData });
      alert(`Agendamento confirmado para ${studentName} às ${selectedSlot} com ${selectedTeacher.name}`);
      setParentName(""); setStudentName(""); setEmail(""); setSelectedSlot(""); setStep(1);
    } catch (err) {
      console.error(err);
      alert("Erro ao enviar o agendamento.");
    }
  };

  if (step === 1) {
    return (
      <div className="p-8">
        <h1 className="text-2xl font-bold mb-4">Selecione a matéria</h1>
        {Object.keys(subjects).map(sub => (
          <button key={sub} className="block mb-2 px-4 py-2 bg-blue-500 text-white rounded" 
                  onClick={() => { setSelectedSubject(sub); setStep(2); }}>
            {sub}
          </button>
        ))}
      </div>
    );
  }

  if (step === 2) {
    return (
      <div className="p-8">
        <h1 className="text-2xl font-bold mb-4">Escolha o professor ({selectedSubject})</h1>
        {subjects[selectedSubject].map(t => (
          <button key={t.id} className="block mb-2 px-4 py-2 bg-green-500 text-white rounded"
                  onClick={() => { setSelectedTeacher(t); setStep(3); }}>
            {t.name}
          </button>
        ))}
        <button className="mt-4 px-4 py-2 bg-gray-400 rounded" onClick={() => setStep(1)}>Voltar</button>
      </div>
    );
  }

  if (step === 3) {
    return (
      <div className="p-8">
        <h1 className="text-2xl font-bold mb-4">Preencha os dados e escolha o horário</h1>
        <input className="block mb-2 p-2 border" placeholder="Nome do responsável" value={parentName} onChange={e => setParentName(e.target.value)} />
        <input className="block mb-2 p-2 border" placeholder="Nome do estudante" value={studentName} onChange={e => setStudentName(e.target.value)} />
        <input className="block mb-2 p-2 border" placeholder="E-mail" value={email} onChange={e => setEmail(e.target.value)} />
        <select className="block mb-2 p-2 border" value={selectedSlot} onChange={e => setSelectedSlot(e.target.value)}>
          <option value="">Selecione um horário</option>
          {timeSlots.map(slot => <option key={slot} value={slot}>{slot}</option>)}
        </select>
        <button className="px-4 py-2 bg-blue-600 text-white rounded" onClick={handleBooking}>Confirmar Agendamento</button>
        <button className="mt-2 px-4 py-2 bg-gray-400 rounded" onClick={() => setStep(2)}>Voltar</button>
      </div>
    );
  }

  return null;
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
