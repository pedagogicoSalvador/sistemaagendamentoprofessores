<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Agendamento - Professores</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // CONFIGURA√á√ÉO - SUBSTITUA PELOS SEUS VALORES
    const GOOGLE_SHEETS_CONFIG = {
      apiKey: "AIzaSyAv9YwX1zbkCZfBNEifBZ8T3tBkUFsh_F4", // coloque aqui a API key do Google Cloud
      spreadsheetId: "1rYNZeln5_eVUEcao25KIWuKfMCYzLg8p1ruM6Ds5VWU", // ID da planilha entre /d/ e /edit
      range: "Agendamentos!A:G" // Nome da aba + colunas
    };

    function TeacherSchedulingSystem() {
      // -----------------------------
      // LISTA DE DISCIPLINAS E PROFESSORES
      // -----------------------------
      const subjects = {
        "Matem√°tica": {
          icon: "üßÆ",
          color: "green",
          teachers: [
            { id: 1, name: "Prof¬™. Aline", turmas: ["7¬∫ anos"] },
            { id: 2, name: "Prof. Mateus", turmas: ["5¬∫ anos", "6¬∫ anos"] }
          ]
        },
        "Portugu√™s": {
          icon: "üìö",
          color: "blue",
          teachers: [
            { id: 3, name: "Prof¬™. Juliana", turmas: ["8¬∫ e 9¬∫ anos"] },
            { id: 4, name: "Prof¬™. Daniella", turmas: ["6¬∫ e 7¬∫ anos"] }
          ]
        },
        "Ci√™ncias e Qu√≠mica": {
              icon: "üî¨",
              color: "purple",
              teachers: [
                { id: 10, name: "Prof¬™. Karina", turmas: ["Ci√™ncias: 6¬∫, Manh√£ e Tarde, 7¬∫, 8¬∫ e 9¬∫ - Tarde"] },
                { id: 11, name: "Prof¬™. Raquel", turmas: ["Qu√≠mica: 2¬™ e 3¬™ s√©ries - EM"] },
                { id: 12, name: "Prof¬™. Roberta", turmas: ["Ci√™ncias: 7¬∫, 8¬∫ e 9¬∫ - Manh√£", "Qu√≠mica: 1¬™ s√©rie: EM"] },
                { id: 13, name: "Prof¬™. Tarine", turmas: ["Ci√™ncias: 5¬∫ anos"] }
              ]
            },
            "Espanhol": {
              icon: "üá™üá∏",
              color: "red",
              teachers: [
                { id: 14, name: "Prof¬™. Michelle", turmas: ["6¬∫ ao 9¬∫ anos"] }
               ]
            },
            "Ingl√™s": {
              icon: "üî§",              
              color: "indigo",
              teachers: [
                { id: 15, name: "Prof¬™ Bianca", turmas: ["EF2 - Tarde"] },
                { id: 16, name: "Prof¬™ Giane", turmas: ["EM"] },
                { id: 17, name: "Prof. Leonardo", turmas: ["9¬∫ anos", "EM"] },
                { id: 18, name: "Prof. Everton", turmas: ["EM"] },
                { id: 19, name: "Prof. Patrick", turmas: ["EM"] },
                { id: 20, name: "Prof¬™ Regina", turmas: ["EM"] },
                { id: 21, name: "Prof¬™ Gisele", turmas: ["EM"] },
              ]
            },
            "Hist√≥ria/Filosofia/Sociologia": {
              icon: "üèõÔ∏è",
              color: "yellow",
              teachers: [
                { id: 22, name: "Prof. Cristiane", turmas: ["Hist√≥ria e Geografia: 5¬∫ anos", "Hist√≥ria: 6¬∫ - Manh√£", "Ensino Religioso"] },
                { id: 23, name: "Prof. Bruno Segatto", turmas: ["Hist√≥ria - EM", "Filosofia - EM", "Sociologia - EM"] },
                { id: 24, name: "Prof. Guilherme", turmas: ["Hist√≥ria: 6¬∫, 7¬∫ e 8¬∫ - Tarde", "Filosofia: 8¬∫ - Tarde"] },
                { id: 25, name: "Prof¬™. Isadora", turmas: ["Hist√≥ria - 7¬∫, 8¬∫ - Manh√£, 9¬∫ anos", "Filosofia: 8¬∫ - Manh√£ e 9¬∫ anos"] }
              ]
            },
            "Geografia": {
              icon: "üåç",
              color: "teal",
              teachers: [
                { id: 26, name: "Prof. Dillian", turmas: ["6¬∫ ao 9¬∫ - EF", "EM"] }
              ]
            },
            "Educa√ß√£o F√≠sica": {
              icon: "‚öΩ",
              color: "orange",
              teachers: [
                { id: 27, name: "Prof. Ana Carolina", turmas: ["5¬∫ ao 9¬∫ anos", "EM"] },
                { id: 28, name: "Prof. Fabiani", turmas: ["7¬∫ ao 9¬∫ anos- Manh√£"] }
              ]
            },
            "Artes": {
              icon: "üé®",
              color: "pink",
              teachers: [
                { id: 29, name: "Prof. Bruno Teixeira", turmas: ["5¬∫ e 6¬∫ anos - EF", "1¬™ s√©ries - EM"] },
                { id: 30, name: "Prof. Marcelo", turmas: ["Teatro", "7¬∫ ao 9¬∫ anos - EF", "2¬™ s√©ries - EM"] }
              ]
            },
            "Educa√ß√£o Tecnol√≥gica": {
              icon: "üíª",
              color: "gray",
              teachers: [
                { id: 31, name: "Prof. Alexandre", turmas: ["5¬∫ ao 8¬∫ anos"] }
              ]
            },
            "Biologia": {
              icon: "üß¨",
              color: "green",
              teachers: [
                { id: 32, name: "Prof. Adir", turmas: ["EM"] }
              ]
            },
            "Literatura": {
              icon: "üìñ",
              color: "purple",
              teachers: [
                { id: 33, name: "Prof¬™. Alexandra", turmas: ["EM"] }
              ]
            },
            "F√≠sica": {
              icon: "‚öõÔ∏è",
              color: "blue",
              teachers: [
                { id: 34, name: "Prof. Daniel", turmas: ["2¬™ e 3¬™ s√©ries - EM"] },
                { id: 35, name: "Prof¬™. Rose", turmas: ["1¬™ s√©ries - EM"] }
              ]
            }
          };
      // -----------------------------
      // GERAR HOR√ÅRIOS (18h30 at√© 19h50 a cada 10min)
      // -----------------------------
      const generateTimeSlots = () => {
        const slots = [];
        let startTime = new Date();
        startTime.setHours(18, 30, 0, 0);

        const endTime = new Date();
        endTime.setHours(19, 50, 0, 0);

        while (startTime <= endTime) {
          const timeString = startTime.toLocaleTimeString("pt-BR", {
            hour: "2-digit",
            minute: "2-digit",
            hour12: false
          });
          slots.push(timeString);
          startTime.setMinutes(startTime.getMinutes() + 10);
        }
        return slots;
      };

      const timeSlots = generateTimeSlots();

      // -----------------------------
      // ESTADOS DO APP
      // -----------------------------
      const [currentScreen, setCurrentScreen] = useState("home");
      const [selectedSubject, setSelectedSubject] = useState("");
      const [selectedTeacher, setSelectedTeacher] = useState(null);
      const [teacherBookings, setTeacherBookings] = useState(new Map());

      const [parentName, setParentName] = useState("");
      const [studentName, setStudentName] = useState("");
      const [email, setEmail] = useState("");
      const [selectedSlot, setSelectedSlot] = useState("");

      const [message, setMessage] = useState("");
      const [messageType, setMessageType] = useState("");
      const [isLoading, setIsLoading] = useState(false);

      // -----------------------------
      // FUN√á√ïES DE AJUDA
      // -----------------------------
      const showMessage = (text, type) => {
        setMessage(text);
        setMessageType(type);
        setTimeout(() => {
          setMessage("");
          setMessageType("");
        }, 4000);
      };

      const getTeacherBookings = (teacherId) => {
        return teacherBookings.get(teacherId) || new Map();
      };

      const getBookedSlots = (teacherId) => {
        const bookings = getTeacherBookings(teacherId);
        return new Set(Array.from(bookings.keys()));
      };

      const isSlotAvailable = (slot, teacherId) => {
        const bookedSlots = getBookedSlots(teacherId);
        return !bookedSlots.has(slot);
      };

      // -----------------------------
      // SALVAR NO GOOGLE SHEETS
      // -----------------------------
      const saveBookingToSheets = async (bookingData) => {
        try {
          setIsLoading(true);

          const newRow = [
            bookingData.teacher,
            bookingData.subject,
            bookingData.parentName,
            bookingData.studentName,
            bookingData.email,
            bookingData.time,
            bookingData.bookingDate
          ];

          const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.range}:append?valueInputOption=RAW&key=${GOOGLE_SHEETS_CONFIG.apiKey}`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ values: [newRow] })
            }
          );

          if (!response.ok) throw new Error("Erro ao salvar no Google Sheets");
          return true;
        } catch (error) {
          console.error("Erro ao salvar:", error);
          showMessage("Erro ao sincronizar com Google Sheets.", "error");
          return false;
        } finally {
          setIsLoading(false);
        }
      };

      // -----------------------------
      // CONFIRMAR AGENDAMENTO
      // -----------------------------
      const handleBooking = async () => {
        const teacherId = selectedTeacher?.id;
        if (!teacherId) return;

        if (!parentName.trim() || !studentName.trim() || !email.trim() || !selectedSlot) {
          showMessage("Preencha todos os campos obrigat√≥rios.", "error");
          return;
        }

        const bookingData = {
          parentName: parentName.trim(),
          studentName: studentName.trim(),
          email: email.trim().toLowerCase(),
          time: selectedSlot,
          bookingDate: new Date().toLocaleDateString("pt-BR"),
          teacher: selectedTeacher.name,
          subject: selectedSubject
        };

        // Salvar localmente
        const currentBookings = getTeacherBookings(teacherId);
        const updatedBookings = new Map([...currentBookings, [selectedSlot, bookingData]]);
        setTeacherBookings((prev) => new Map([...prev, [teacherId, updatedBookings]]));

        // Salvar no Google Sheets
        const savedToSheets = await saveBookingToSheets(bookingData);

        if (savedToSheets) {
          showMessage(`‚úÖ Agendamento confirmado e salvo no Google Sheets!`, "success");
        } else {
          showMessage(`‚ö†Ô∏è Agendamento confirmado localmente, mas houve erro ao salvar no Google Sheets.`, "error");
        }

        // limpar formul√°rio
        setParentName("");
        setStudentName("");
        setEmail("");
        setSelectedSlot("");
      };

      // -----------------------------
      // TELAS DO SISTEMA
      // -----------------------------
      if (isLoading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <p className="text-xl">‚è≥ Sincronizando com Google Sheets...</p>
          </div>
        );
      }

      // Tela inicial
      if (currentScreen === "home") {
        return (
          <div className="min-h-screen bg-indigo-50 p-6 text-center">
            <h1 className="text-3xl font-bold mb-4">üéì Sistema de Agendamento</h1>
            <p className="mb-2">Hor√°rios: 18h30 √†s 19h50 (10min cada)</p>
            <button
              onClick={() => setCurrentScreen("subjects")}
              className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
            >
              Come√ßar Agendamento
            </button>
          </div>
        );
      }

      // Tela de disciplinas
      if (currentScreen === "subjects") {
        return (
          <div className="p-6">
            <h2 className="text-2xl font-bold mb-4">Selecione a Disciplina</h2>
            <div className="grid grid-cols-2 gap-4">
              {Object.entries(subjects).map(([subject, data]) => (
                <button
                  key={subject}
                  onClick={() => {
                    setSelectedSubject(subject);
                    setCurrentScreen("teachers");
                  }}
                  className="p-4 bg-gray-100 rounded-lg hover:bg-gray-200"
                >
                  <span className="text-2xl">{data.icon}</span>
                  <h3 className="font-bold">{subject}</h3>
                </button>
              ))}
            </div>
          </div>
        );
      }

      // Tela de professores
      if (currentScreen === "teachers") {
        const subjectData = subjects[selectedSubject];
        return (
          <div className="p-6">
            <h2 className="text-2xl font-bold mb-4">{selectedSubject}</h2>
            <div className="grid grid-cols-2 gap-4">
              {subjectData.teachers.map((teacher) => (
                <button
                  key={teacher.id}
                  onClick={() => {
                    setSelectedTeacher(teacher);
                    setCurrentScreen("booking");
                  }}
                  className="p-4 bg-white border rounded-lg hover:border-blue-400"
                >
                  <h3 className="font-bold">{teacher.name}</h3>
                  <p className="text-sm text-gray-500">{teacher.turmas.join(", ")}</p>
                </button>
              ))}
            </div>
          </div>
        );
      }

      // Tela de agendamento
      if (currentScreen === "booking") {
        return (
          <div className="p-6">
            <h2 className="text-2xl font-bold mb-4">Agendar com {selectedTeacher.name}</h2>
            <p className="mb-4">üìö {selectedSubject}</p>

            <input
              type="text"
              placeholder="Nome do Respons√°vel"
              value={parentName}
              onChange={(e) => setParentName(e.target.value)}
              className="w-full p-2 mb-2 border rounded"
            />
            <input
              type="text"
              placeholder="Nome do Estudante"
              value={studentName}
              onChange={(e) => setStudentName(e.target.value)}
              className="w-full p-2 mb-2 border rounded"
            />
            <input
              type="email"
              placeholder="Email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full p-2 mb-2 border rounded"
            />
            <select
              value={selectedSlot}
              onChange={(e) => setSelectedSlot(e.target.value)}
              className="w-full p-2 mb-2 border rounded"
            >
              <option value="">Selecione um hor√°rio</option>
              {timeSlots.map((slot) => (
                <option
                  key={slot}
                  value={slot}
                  disabled={!isSlotAvailable(slot, selectedTeacher.id)}
                >
                  {slot} {isSlotAvailable(slot, selectedTeacher.id) ? "(Dispon√≠vel)" : "(Ocupado)"}
                </option>
              ))}
            </select>

            <button
              onClick={handleBooking}
              className="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
            >
              Confirmar Agendamento
            </button>

            {message && (
              <div
                className={`mt-4 p-2 rounded ${
                  messageType === "success"
                    ? "bg-green-100 text-green-700"
                    : "bg-red-100 text-red-700"
                }`}
              >
                {message}
              </div>
            )}
          </div>
        );
      }

      return null;
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<TeacherSchedulingSystem />);
  </script>
</body>
</html>




